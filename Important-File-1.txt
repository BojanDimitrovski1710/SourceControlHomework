Very important code, lots of important stuff in here